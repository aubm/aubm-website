<!doctype html>
<html>
<head>
    <base href="/">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no">
<meta name="author" content="Aurélien Baumann (Aubm)">

<meta name="description" content="">

<title>Retour d&#39;expérience sur Joomla, point de vue d&#39;un développeur</title>
<meta name="generator" content="Hugo 0.19-DEV" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.1.0/styles/pojoaque.min.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.1.0/highlight.min.js"></script>
<script>hljs.initHighlightingOnLoad();</script>

<link href="https://fonts.googleapis.com/css?family=Source+Code+Pro:400,700" rel="stylesheet" type="text/css">
<link  href="http://www.aubm.net/css/theme.min.css" rel="stylesheet" type="text/css">

</head>
<body>
<div class="page-container container-fluid">
<div class="col-md-3 menu">
    <nav class="col-md-3">
    <h3 class="home-link"><a href="/">Racine</a></h3>
    <div id="last-posts" class="open">
        <h3 data-open="last-posts">Aubm - Les derniers articles</h3>
        <ul>
            
            <li><a href="http://www.aubm.net/blog/pourquoi-big-o-est-important/">Pourquoi Big O est important ?</a></li>
            
            <li><a href="http://www.aubm.net/blog/comment-vous-faire-une-idee-d-l-impact-de-la-latence-de-votre-televiseur-dans-vos-sessions-de-jeux-videos/">Comment vous faire une idée de l&#39;impact de la latence de votre téléviseur dans vos sessions de jeux vidéos</a></li>
            
            <li><a href="http://www.aubm.net/blog/testing-d-une-app-golang-sur-appengine-une-maniere-de-gerer-l-erreur-newcontext-passed-an-unknown-http-request/">Testing d&#39;une app golang sur AppEngine : une manière de gérer l&#39;erreur NewContext passed an unknown http.Request</a></li>
            
            <li><a href="http://www.aubm.net/blog/l-injection-de-dependances-a-l-esprit-dans-vos-applications-golang/">L&#39;injection de dépendances à l&#39;esprit dans vos applications Golang</a></li>
            
            <li><a href="http://www.aubm.net/blog/aller-plus-loin-avec-postman/">Aller plus loin avec Postman</a></li>
            
            <li><a href="http://www.aubm.net/blog/du-neuf-sous-le-capot/">Du neuf sous le capot</a></li>
            
            <li><a href="http://www.aubm.net/blog/gardez-le-code-explicite-court-et-modulaire/">Gardez le code explicite, court et modulaire</a></li>
            
            <li><a href="http://www.aubm.net/blog/contrainte-dunicite-dans-symfony-2-avec-doctrine/">Contrainte d&#39;unicité dans Symfony 2 avec Doctrine</a></li>
            
            <li><a href="http://www.aubm.net/blog/mes-premiers-pas-avec-cakephp-3/">Mes premiers pas avec CakePHP 3</a></li>
            
            <li><a href="http://www.aubm.net/blog/installation-et-utilisation-de-sentry/">Installation et utilisation de Sentry</a></li>
            
        </ul>
    </div>

    
    <div id="tags" class="open">
        <h3 data-open="tags">Tags</h3>
        <ul class="tags">
            
            <li><a href="/tags/astuce">astuce</a></li>
            
            <li><a href="/tags/cakephp">cakephp</a></li>
            
            <li><a href="/tags/doctrine">doctrine</a></li>
            
            <li><a href="/tags/golang">golang</a></li>
            
            <li><a href="/tags/joomla">joomla</a></li>
            
            <li><a href="/tags/php">php</a></li>
            
            <li><a href="/tags/solution">solution</a></li>
            
            <li><a href="/tags/symfony">symfony</a></li>
            
        </ul>
    </div>
    

    
</nav>

</div>
<div class="col-md-9 content">

<h1>Retour d&#39;expérience sur Joomla, point de vue d&#39;un développeur</h1>
<h4>Publié le 10-01-2014 00:07:05</h4>

<a href="https://twitter.com/share" class="twitter-share-button" data-via="kendo5731"></a>
<script>!function (d, s, id) {
    var js, fjs = d.getElementsByTagName(s)[0], p = /^http:/.test(d.location) ? 'http' : 'https';
    if (!d.getElementById(id)) {
        js = d.createElement(s);
        js.id = id;
        js.src = p + '://platform.twitter.com/widgets.js';
        fjs.parentNode.insertBefore(js, fjs);
    }
}(document, 'script', 'twitter-wjs');</script>

<div class="fb-share-button" data-href="http://www.aubm.net/blog/retour-dexperience-sur-joomla-point-de-vue-dun-developpeur/" data-layout="button"></div>
<div id="fb-root"></div>
<script>(function(d, s, id) {
    var js, fjs = d.getElementsByTagName(s)[0];
    if (d.getElementById(id)) return;
    js = d.createElement(s); js.id = id;
    js.src = "//connect.facebook.net/fr_FR/sdk.js#xfbml=1&version=v2.5";
    fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>

<article>
    

<h2 id="introduction">Introduction</h2>

<p>Joomla - à l&rsquo;instar de Wordpress et Drupal -  est un CMS permettant à des utilisateurs non-développeurs d&rsquo;installer et de configurer un site internet. Le CMS s&rsquo;adresse également aux développeurs, en leur proposant une API leur permettant d&rsquo;étendre ses fonctionnalités. D&rsquo;aucuns sont alors tentés de choisir Joomla pour démarrer un projet impliquant du développement spécifique. Sur le papier l&rsquo;argumentaire est imparable : pourquoi ne pas utiliser le CMS comme base pour ce projet, pour lequel Joomla sorti de la boite couvre 80% des besoins du client ? C&rsquo;est autant de temps de gagner.</p>

<p>Pendant presque deux ans, j&rsquo;ai eu l&rsquo;occasion de prendre part à de nombreux développements sur Joomla. Cette expérience m&rsquo;a conduit à penser que dans certains cas, cette logique est applicable. En effet, pour un budget moyen et dans le cas d&rsquo;un projet de site web répondant aux caractéristiques classiques d&rsquo;un blog, d&rsquo;une vitrine ou éventuellement d&rsquo;un e-commerce, cette hypothèse semble se vérifier. Il est cependant de nombreux cas où le besoin métier du client représentant les 20% de développement restant représentent en réalité bien plus que 20% du temps de développement global. Pour ce type de projets, mieux vaut s&rsquo;assurer de choisir un bon environnement de développement pour travailler.</p>

<p>Alors Joomla est-il un bon terrain de jeu ? Sur le sujet ma position est claire : non. Dans cet article je vais tâcher de défendre ce point de vue.
Sans vouloir tomber dans du troll, certains points de vue restent personnels et donc discutables. Il pourrait être intéressant de les confronter à des visions différentes.</p>

<h2 id="modulaire-mais-pas-extensible">Modulaire mais pas extensible</h2>

<p>L&rsquo;argumentaire &ldquo;commercial&rdquo; de Joomla repose sur sa modularité. L&rsquo;architecture du CMS permet effectivement de développer des extensions afin d&rsquo;ajouter des fonctionnalités sans altérer le core du logiciel. Vous pouvez donc envisager de développer un forum, un composant de petites annonces, ou encore une solution permettant d&rsquo;exporter des données vers un CRM ; le tout en cohabitation avec la gestion du blog et des utilisateurs fournie par le CMS.</p>

<p>Bien, je souhaite maintenant étendre le composant de gestion des contenus du site afin d&rsquo;y ajouter la possibilité de renseigner un champ supplémentaire. La désillusion commence ici, car à problème simple, solution &hellip; pas simple. Malheureusement le CMS ne permet pas d&rsquo;étendre les fonctionnalités des composants natifs. Pour un besoin comme celui-ci il faudra passer par le développement d&rsquo;un composant à part entière afin d&rsquo;ajouter les fonctionnalités manquantes (ou éventuellement l&rsquo;utilisation d&rsquo;un composant tiers, mais cela pourrait apporter de nouvelles contraintes).</p>

<p>On serait tenté de dire qu&rsquo;il s&rsquo;agit là d&rsquo;un exemple isolé et que ces problématiques ne sont pas récurrentes. J&rsquo;ai pourtant été confronté à des cas similaires de nombreuses fois. La raison pour laquelle cela est réellement gênant est que ces problèmes trahissent en vérité des erreurs importantes de conception. Dans le meilleur des mondes, Joomla mettrait à disposition un composant d&rsquo;injection de dépendances couplé à une stratégie d&rsquo;abstraction sur les classes utilisées dans les composants du core. Ainsi une hypothétique classe concrète <code>Content</code> pourrait être remplacée par une classe <code>MyCustomContent</code>, quelques détails à régler, un petit script de migration pour modifier la structure de la base de données et le tour est joué. On est très loin de ça.</p>

<p>J&rsquo;aborde là des notions relatives au design objet, le but n&rsquo;est pas de m&rsquo;égarer dans des idées trop éloignées du sujet. Je suis conscient que l&rsquo;utilisation de certaines techniques pourrait sembler surévaluée et en ça il s&rsquo;agit là d&rsquo;un point de vue discutable. Ceci étant dit, s&rsquo;il est question de choisir un environnement pour développer une application relativement complexe, alors s&rsquo;orienter vers une solution plus ouverte me semble plus judicieux. Car si le problème mis en évidence ici est relatif à la couche fonctionnelle du CMS, des erreurs similaires existent au niveau du framework.</p>

<p><img src="/img/saquedeneu.png" alt="Saquedeneu" class="img-responsive"/></p>

<p>Force est de constater que les contributeurs de Joomla fournissent un travail important pour améliorer la qualité du code. Je précise au passage que certains aspects sont intéressants (comme notamment le fonctionnement des plugins). Cependant Joomla (à l&rsquo;origine fork de Mambo) est construit de manière empirique et à ce stade du projet, la tâche est herculéenne. Conscients des faiblesses de Drupal 7, les développeurs de Drupal 8 ont choisi de reprendre le projet à zéro.</p>

<h2 id="joomla-le-vilain-petit-canard">Joomla le vilain petit canard</h2>

<h3 id="psr-quoi">PSR quoi ?</h3>

<p>A l&rsquo;heure où j&rsquo;écris, une partie du framework est réécrite avec dans l&rsquo;optique d&rsquo;embrasser des techniques de codage plus au goût de ce qui se fait aujourd&rsquo;hui dans le monde de PHP. Bien que pour le développeur d&rsquo;extensions cela relève plus de l&rsquo;anecdote qu&rsquo;autre chose, c&rsquo;est plutôt une bonne nouvelle. Car si Joomla 3.4 requiert au minimum PHP 5.3, l&rsquo;utilisation des namespaces dans le code des extensions suscitera éventuellement de timides &ldquo;pourquoi pas ?&rdquo; mais toujours pas d&rsquo;applaudissements. On attend avec impatience le jour où l&rsquo;auto-chargement des classes conforme PSR-0 ou PSR-4 sera géré par le CMS. En attendant vous pouvez continuer à le configurer manuellement pour chacune de vos classes.</p>

<h3 id="un-router-pour-le-moins-original">Un router pour le moins original</h3>

<p>Les composants du CMS doivent respecter une structure pour fonctionner. Des contrôleurs sont définis pour isoler la logique de l&rsquo;application. En réalité cette responsabilité est partagée entre les contrôleurs et les vues. C&rsquo;est un peu différent de ce qu&rsquo;on peut trouver dans d&rsquo;autres frameworks mais pourquoi pas.</p>

<p>Ce qui me laisse un peu perplexe en revanche c&rsquo;est le fonctionnement du router. Le contrôleur et l&rsquo;action qui prendront en charge la requête sont définis par des variables de requête. Si bien que cette requête <code>index.php?option=com_forum&amp;task=message.save</code> sera prise en charge par la méthode <code>save()</code> du contrôleur <code>Message</code> du composant <code>Forum</code>. Le flow d&rsquo;exécution de la requête est donc sous le contrôle partiel de l&rsquo;utilisateur du site. Il est possible de la même façon de déterminer le fichier de vue et le template à utiliser en forçant une valeur pour les variables <code>view</code> et <code>tmpl</code>. Pour info, si une combinaison de valeurs ne fonctionne pas, <a href="http://www.joomla.org/index.php?option=com_content&task=john.doe" target="_blank">l&rsquo;application renverra une 500</a>.</p>

<p>Pour utiliser des urls plus &ldquo;SEO friendly&rdquo;, il faudra donc mettre en place un fichier <code>router.php</code> à l&rsquo;intérieur du composant, fichier dans lequel la réécriture des urls est définie programmatiquement. Pas franchement simple donc, à titre d&rsquo;exemple, le fichier router du composant de gestion de contenu embarqué dans le CMS <a href="https://github.com/joomla/joomla-cms/blob/staging/components/com_content/router.php" target="_blank">compte pas loin de 500 lignes</a>, quid des performances ? Sans compter qu&rsquo;il est impossible de personnaliser les routes des composants natifs de Joomla.</p>

<p>A noter qu&rsquo;activer la réécriture des urls n&rsquo;empêchera pas les utilisateurs de la boycotter et d&rsquo;accéder à <code>index.php?option=com_....</code>. Cela ne les empêchera pas non plus d&rsquo;accéder aux autres fichiers du site d&rsquo;ailleurs, étant donné que le point d&rsquo;entrée (supposé) de l&rsquo;application est situé à un niveau d&rsquo;arborescence supérieur aux fichiers des composants. Forçant ainsi à vérifier la déclaration de la constante <code>_JEXEC</code> au début de chaque fichier (pas très élégant &hellip;), et accessoirement de placer un <code>index.html</code> vide dans chaque sous répertoire.</p>

<h3 id="a-propos-d-élégance">A propos d&rsquo;élégance</h3>

<p>A propos d&rsquo;élégance (ou plus exactement de praticité), il y a un certain nombre de points qui méritent d&rsquo;être soulignés.</p>

<p>Par exemple, si une mise à jour d&rsquo;un composant du site implique des modifications dans la structure de la base de données, il est préférable d&rsquo;ajouter un fichier de migration afin de faciliter la mise à jour de ce composant sur le serveur de production. Un peu dommage que ces fichiers contiennent des requêtes SQL qu&rsquo;il faut écrire à la main. Doctrine ou Eloquent (à titre d&rsquo;exemples) peuvent tous deux générer des scripts équivalents via un CLI avec en bonus des possibilités de rollback (ce qui n&rsquo;est pas le cas ici je précise).</p>

<p>En parlant d&rsquo;ORM, à noter que Joomla n&rsquo;embarque pas d&rsquo;ORM. Il faudra se contenter d&rsquo;un composant d&rsquo;abstraction sur la base de données (une petite sur-couche à PDO) présentant au moins l&rsquo;avantage de pouvoir construire des requêtes SQL plus facilement en manipulant des objets. C&rsquo;est regrettable, surtout quand il s&rsquo;agit d&rsquo;extraire des données de plusieurs tables, l&rsquo;utilisation d&rsquo;un ORM peut faire gagner un temps précieux.</p>

<p>Parmi les éléments qui me viennent à l&rsquo;esprit, j&rsquo;évoquerai aussi la définition des formulaires dans des fichiers XML. L&rsquo;idée est bonne sur la papier dans la mesure où cela vise à faciliter des tâches fastidieuses comme la validation des données ou la génération de templates. Dans la pratique il est des cas où cette approche apporte plus de contraintes qu&rsquo;autre chose. Quid des formulaires dynamiques par exemple ?</p>

<p>Rien de bien grave dans tout ça me direz-vous et c&rsquo;est sans doute vrai. Rien de véritablement bloquant pour achever le développement du site, mais je rappelle qu&rsquo;il est question de choisir un environnement de développement confortable permettant de travailler efficacement (et donc plus rapidement). Sur les points cités plus haut comme sur de nombreux autres, Joomla n&rsquo;est clairement pas au niveau de ce que proposent des frameworks concurrents.</p>

<h3 id="une-maturité-discutable">Une maturité discutable</h3>

<p>Si il semble qu&rsquo;aujourd&rsquo;hui, la culture du test commence à rentrer dans les moeurs, ce n&rsquo;était pas le cas il y a encore relativement peu de temps. La communauté semble effectivement avoir <a href="http://developer.joomla.org/news/597-release-postmortem.html" target="_blank">appris de ses erreurs</a> et une grande partie du code est aujourd&rsquo;hui (enfin) couverte par des tests. Ces tests ne garantissent évidemment pas le fonctionnement de l&rsquo;application mais permettent au moins de contrôler un certain nombre de régressions.</p>

<p><img src="/img/iron_man.gif" alt="Iron man" class="img-responsive"/></p>

<p>Cela reste un avis très personnel mais je ne peux m&rsquo;empêcher de penser qu&rsquo;une prise de conscience aussi tardive pourrait témoigner d&rsquo;un certain manque de maturité du logiciel, ce qui est assez paradoxal étant donné son ancienneté.</p>

<p>On pourrait en dire autant sur la documentation officielle pour les développeurs, qui aujourd&rsquo;hui encore paraît assez maigre (notamment en terme d&rsquo;exemples) à côté de la quantité de ressources que l&rsquo;on peut trouver sur les sites respectifs de Laravel ou de Symfony (pour ne citer qu&rsquo;eux).
Encore un paradoxe d&rsquo;ailleurs, étant donné que ce n&rsquo;est pourtant pas le contenu qui manque entre <a class="http://dev.joomla.fr/" target="_blank">dev.joomla.fr</a>, <a href="http://developer.joomla.org/" target="_blank">developper.joomla.org</a> ou encore <a href="https://docs.joomla.org/Portal:Developers" target="_blank">docs.joomla.org/Portal:Developers</a> &hellip; J&rsquo;y mets peut-être un peu de mauvaise volonté mais quelqu&rsquo;un pourrait me dire par où commencer ?</p>

<h2 id="performance-scalabilité-et-maintenance">Performance, scalabilité et maintenance</h2>

<p>La performance c&rsquo;est souvent la bête noire des CMS. En tout cas pour ceux orientés &ldquo;end-user&rdquo;, étant donné que beaucoup font le choix de stocker un (trop) grand nombre d&rsquo;informations en base de données et que les accès I/O sont généralement les opérations les plus couteuses.</p>

<p>Joomla peine à déroger à la règle, c&rsquo;est effectivement délicat quand le choix est fait de stocker en base de données, des données relatives au paramétrage des composants par exemple. <a href="http://www.chronoengine.com/downloads/chronoforms.html" target="_blank">Certains composants</a> poussent le vice assez loin en allant jusqu&rsquo;à stocker en base de données des fragments de code destinés à être exécutés.</p>

<p>La complexification des requêtes SQL peut également être une conséquence indirecte de la nature modulaire mais peu extensible du CMS (cf. début de l&rsquo;article). En effet si ajouter une information sur le numéro de téléphone des utilisateurs ne peut être fait en modifiant directement la table des utilisateurs, un composant tiers n&rsquo;aura alors d&rsquo;autre choix que d&rsquo;ajouter une table <code>users_extra_data</code> comportant une clé étrangère vers la table <code>users</code>.</p>

<p>Une mauvaise optimisation de la base de données ne représente pas un problème majeur au départ. On peut toujours investir 200 euros de plus par an pour que l&rsquo;application s&rsquo;exécute convenablement. C&rsquo;est sur le moyen/long terme que ces problèmes peuvent devenir gênants, alors que le traffic augmente sur le site, la besoin en resources augmentera de manière exponentielle.</p>

<p>A noter également qu&rsquo;en terme de maintenance, qu&rsquo;il s&rsquo;agisse de versionner le projet ou de configurer un environnement de test, cette mauvaise utilisation de la base de données ne facilitera pas la tâche.</p>

<h2 id="le-mot-de-la-fin">Le mot de la fin</h2>

<p>Le tour n&rsquo;est pas encore complet et il y aurait évidemment encore beaucoup à dire (en bon comme en mauvais). Je pense cependant avoir donné suffisamment d&rsquo;éléments pour défendre mon point de vue.</p>

<p>N&rsquo;hésitez pas à commenter pour donner votre retour, et merci pour la lecture !</p>

</article>

<div id="disqus_thread"></div>
<script type="text/javascript">
    var disqus_shortname = 'wwwaubmnet';
    var disqus_identifier = 'http:\/\/www.aubm.net\/blog\/retour-dexperience-sur-joomla-point-de-vue-dun-developpeur\/';
    var disqus_title = 'Retour d\x27expérience sur Joomla, point de vue d\x27un développeur';
    var disqus_url = 'http:\/\/www.aubm.net\/blog\/retour-dexperience-sur-joomla-point-de-vue-dun-developpeur\/';

    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>

</div>
</div>
<script src="js/theme.min.js" type="text/javascript"></script>

<script>
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-38043974-6', 'auto');
ga('send', 'pageview');
</script>


</body>
</html>

